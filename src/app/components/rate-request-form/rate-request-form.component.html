<form class="row" [formGroup]="form" (ngSubmit)="onSubmit()">
	<div class="col-md-6">
		<app-destination-header prefix="From" [domestic]="true"></app-destination-header>
		<div class="row g-3" formGroupName="shipperDetails">
			<div class="col-12 d-none">
				<select
					formControlName="countryCode"
					class="form-select"
					required
				>
					<option value="CA">Canada</option>
				</select>
			</div>
			<div class="col-6">
				<app-dropdown placeholder="Postal Code" 
					[options]="shipperPostalCodes"	
					formControlName="postalCode"
					[debounce]="600"
					[required]="true"
					(valueChange)="onPostalCodeChanged($event, FromEnum.SHIPPER)"
					(select)="onAddressSelect($event, 'postalCode', FromEnum.SHIPPER)"
				><span class="input-group-text" id="basic-addon1">$</span></app-dropdown>
			</div>
			<div class="col-md-6">
				<app-dropdown placeholder="City"
					formControlName="cityName"
					[options]="shipperCities"	
					[required]="true"
					[debounce]="600"
					(valueChange)="onCityNameChanged($event, FromEnum.SHIPPER)"
					(select)="onAddressSelect($event, 'cityName', FromEnum.SHIPPER)"
				/>
			</div>
			<div class="col-md-12 input-group">
        <span class="input-group-text"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-flag" viewBox="0 0 16 16">
          <path d="M14.778.085A.5.5 0 0 1 15 .5V8a.5.5 0 0 1-.314.464L14.5 8l.186.464-.003.001-.006.003-.023.009a12 12 0 0 1-.397.15c-.264.095-.631.223-1.047.35-.816.252-1.879.523-2.71.523-.847 0-1.548-.28-2.158-.525l-.028-.01C7.68 8.71 7.14 8.5 6.5 8.5c-.7 0-1.638.23-2.437.477A20 20 0 0 0 3 9.342V15.5a.5.5 0 0 1-1 0V.5a.5.5 0 0 1 1 0v.282c.226-.079.496-.17.79-.26C4.606.272 5.67 0 6.5 0c.84 0 1.524.277 2.121.519l.043.018C9.286.788 9.828 1 10.5 1c.7 0 1.638-.23 2.437-.477a20 20 0 0 0 1.349-.476l.019-.007.004-.002h.001M14 1.221c-.22.078-.48.167-.766.255-.81.252-1.872.523-2.734.523-.886 0-1.592-.286-2.203-.534l-.008-.003C7.662 1.21 7.139 1 6.5 1c-.669 0-1.606.229-2.415.478A21 21 0 0 0 3 1.845v6.433c.22-.078.48-.167.766-.255C4.576 7.77 5.638 7.5 6.5 7.5c.847 0 1.548.28 2.158.525l.028.01C9.32 8.29 9.86 8.5 10.5 8.5c.668 0 1.606-.229 2.415-.478A21 21 0 0 0 14 7.655V1.222z"/>
        </svg></span>
				<input
					class="form-control"
					type="text"
					formControlName="provinceCode"
					placeholder="Province"
					aria-label="Province"
          maxlength="35"
					appTrimText
				/>
			</div>
			<div class="col-md-12">
				<label>* Required Information</label>
			</div>
		</div>
	</div>
	<div class="col-md-6" formGroupName="receiverDetails">
		<app-destination-header prefix="To" [domestic]="domestic"></app-destination-header>
		<div class="row g-3">
			<div class="col-12" *ngIf="!domestic">
				<app-dropdown placeholder="Country" 
					[options]="countries"	
					formControlName="countryCode" 
					[required]="true"
					(select)="onCountrySelect($event)"
				/>
			</div>
			<div class="col-6">
				<app-dropdown placeholder="Postal Code" 
					[options]="postalCodes"	
					formControlName="postalCode"
					[debounce]="600"
					[required]="requirePostalCode"
					(valueChange)="onPostalCodeChanged($event, FromEnum.RECEIVER)"
					(select)="onAddressSelect($event, 'postalCode', FromEnum.RECEIVER)"
				/>
			</div>
			<div class="col-md-6">
				<app-dropdown placeholder="City"
					formControlName="cityName"
					[options]="cities"	
					[required]="true"
					[debounce]="600"
					(valueChange)="onCityNameChanged($event, FromEnum.RECEIVER)"
					(select)="onAddressSelect($event, 'cityName', FromEnum.RECEIVER)"
				/>
			</div>
			<div class="col-md-12 input-group">
        <span class="input-group-text"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-flag" viewBox="0 0 16 16">
          <path d="M14.778.085A.5.5 0 0 1 15 .5V8a.5.5 0 0 1-.314.464L14.5 8l.186.464-.003.001-.006.003-.023.009a12 12 0 0 1-.397.15c-.264.095-.631.223-1.047.35-.816.252-1.879.523-2.71.523-.847 0-1.548-.28-2.158-.525l-.028-.01C7.68 8.71 7.14 8.5 6.5 8.5c-.7 0-1.638.23-2.437.477A20 20 0 0 0 3 9.342V15.5a.5.5 0 0 1-1 0V.5a.5.5 0 0 1 1 0v.282c.226-.079.496-.17.79-.26C4.606.272 5.67 0 6.5 0c.84 0 1.524.277 2.121.519l.043.018C9.286.788 9.828 1 10.5 1c.7 0 1.638-.23 2.437-.477a20 20 0 0 0 1.349-.476l.019-.007.004-.002h.001M14 1.221c-.22.078-.48.167-.766.255-.81.252-1.872.523-2.734.523-.886 0-1.592-.286-2.203-.534l-.008-.003C7.662 1.21 7.139 1 6.5 1c-.669 0-1.606.229-2.415.478A21 21 0 0 0 3 1.845v6.433c.22-.078.48-.167.766-.255C4.576 7.77 5.638 7.5 6.5 7.5c.847 0 1.548.28 2.158.525l.028.01C9.32 8.29 9.86 8.5 10.5 8.5c.668 0 1.606-.229 2.415-.478A21 21 0 0 0 14 7.655V1.222z"/>
        </svg></span>
				<input
					class="form-control"
					type="text"
					formControlName="provinceName"
					placeholder="Province"
					aria-label="Province"
          maxlength="35"
					appTrimText
				/>
			</div>
		</div>
	</div>
	<ng-container *ngIf="isParcelPackage">
		<div class="col-md-6">
			<img src="assets/images/package.svg" width="90%" alt="Package dimension">
		</div>
		<div class="col-md-6 packages">
			<!-- <div class="row g-3 p-1">
				<div class="col-md-2">
					<label class="form-label text-center"
						>Length(ln)
					</label>
				</div>
				<div class="col-md-2">
					<label class="form-label">Width(ln) </label>
				</div>
				<div class="col-md-2">
					<label class="form-label">Height(ln) </label>
				</div>
				<div class="col-md-2">
					<label class="form-label">Weight(LB) </label>
				</div>
			</div> -->
			<div formArrayName="packages">
				<div class="row g-3 p-2 mt-3 package"
					*ngFor="let item of packages; let i = index; let isLast=last; trackBy: trackByIndex"
					formGroupName="{{i}}">
				<div class="col-md-5">
					<label class="form-label d-block h5">Weight *</label>
					<input
						class="form-control d-inline w-75"
						type="number"
						formControlName="weight"
						min="1"
						max="9999"
						placeholder="Weight"
						aria-label="Weight"
					/><div class="px-1 d-inline h5">lbs</div>
				</div>
				<div class="col-md-5">
					<label class="form-label d-block h5"
						>Length *
					</label>
					<input
						class="form-control d-inline w-75"
						type="number"
						formControlName="length"
						placeholder="Length"
						min="1"
						max="9999"
						aria-label="Length"
					/><div class="px-1 d-inline h5">ln</div>
				</div>
				<div class="col-md-5">
					<label class="form-label d-block h5">Width *</label>
					<input
						class="form-control d-inline w-75"
						type="number" 
						formControlName="width"
						placeholder="Width"
						min="1"
						max="9999"
						aria-label="Width"
					/><div class="px-1 d-inline h5">ln</div>
				</div>
				<div class="col-md-5">
					<label class="form-label d-block h5">Height *</label>
					<input
						class="form-control d-inline w-75"
						type="number"
						formControlName="height"
						min="1"
						max="9999"
						placeholder="Height"
						aria-label="Height"
					/><div class="px-1 d-inline h5">ln</div>
				</div>
				<div class="col-md-2" *ngIf="!rateResponse">
					<div class="col-md-6" *ngIf="!isLast">
						<div class="text-center fs-4" role="button" (click)="removePackage(i)">-</div>
					</div>
					<div class="col-md-6" *ngIf="isLast">
						<div class="text-center fs-4" role="button" (click)="addPackage()">+</div>
					</div>
				</div>
			</div>
			</div>
			<div class="col-md-12 p-2 w-75 d-none" *ngIf="!!rateResponse">
				<input
					class="form-control"
					type="text"
					formControlName="verification"
					placeholder="Verification Code (Ask the Clerk)"
					aria-label="Verification"
					pattern="test_123"
					[required]="!!rateResponse"
				/>
			</div>
		</div>
	</ng-container>
	<div class="text-center col-12 p-3" *ngIf="!rateResponse">
		<button
			type="submit"
			class="btn btn-danger btn-lg "
			[disabled]="!form.valid"
		>
			Get Rates
		</button>
	</div>
	<div class="text-center col-12 p-3" *ngIf="!!rateResponse">
		<button type="button" class="btn btn-danger btn-lg" (click)="onReset()">
			Reset
		</button>
	</div>
</form>
